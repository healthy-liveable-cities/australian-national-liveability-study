* Project: li_perth_2016 : scale up estimates for dwellings or persons 
* Date:    July 2018
* Author:  Carl Higgs

*** set up session ***
capture log close
version 13.1
set linesize 100
set more off
global today = c(current_date)

* specify data location
cd "D:\ntnl_li_2018_template\process\stata"

log using "li_perth_2016_scale_estimates_for_dwellings${today}.txt", append text
pwd /* print working directory, so it's there in the log file*/

/* Define style for graphs (Tufte inspired: white background, 
   horizontal text, minimal grids, nice colours)               */
global theme graphr(color(white) lw(medium) lc(black) ilc(white)) plotr(color(white) lw(medium) lc(white) ) scheme(s2gcolor)
global ystyle ylab(,axis(1) angle(h) nogrid labsize(small) tstyle(minor)) ytitle(,axis(1) margin(medsmall)) ysca(axis(1) extend)
global xstyle xlab(,axis(1) labsize(small) tstyle(minor)) xtitle(,axis(1) margin(medsmall)) xsca(axis(1) extend)
global mstyle msize(medium) mlwidth(vvthin)
global box_style  ${theme} ${ystyle} 
global tw_style   ${theme} ${ystyle} ${xstyle}  yaxis(1 2) xaxis(1 2) ysca(axis(2) on  line) xsca(axis(2) on  line) ylab(none,axis(2) )  xlab(none,axis(2)) ytitle("",axis(2)) xtitle("",axis(2))
global tw_style_alt   ${theme} ${ystyle} ${xstyle}  yaxis(1 2) xaxis(1 2) ysca(axis(2) on  line) xsca(axis(2) on  line) ylab(none,axis(1) )  xlab(none,axis(1))  ytitle(,axis(2) margin(medsmall)) xtitle(,axis(2) margin(medsmall)) ytitle("",axis(1) margin(medsmall)) xtitle("",axis(1) margin(medsmall))


* get data
odbc load, exec("SELECT a.gnaf_pid, mb_code_20 AS mb_code_2016, distance FROM parcel_dwellings a LEFT JOIN od_closest b ON a.gnaf_pid = b.gnaf_pid WHERE dest = 13;") conn("Driver={PostgreSQL Unicode(x64)};Server=localhost;Port=5432;Database=li_perth_2016;Uid=postgres;Pwd=***REMOVED***;")  clear

* make id numeric
destring mb_code_2016, replace
format %11.0f mb_code_2016

set seed 731           /*  Change seed to whatever you want */

loc test_mb = mb_code_2016[ runiform(1,c(N))]
di %11.0f `test_mb'
count if mb_code_2016 == `test_mb'
hist distance if mb_code_2016 == `test_mb'

odbc load, exec("SELECT * FROM sim_dwellings_access_train") conn("Driver={PostgreSQL Unicode(x64)};Server=localhost;Port=5432;Database=li_perth_2016;Uid=postgres;Pwd=***REMOVED***;")  clear

su mean sim_access
count if mean <= 1000
di 100*r(N)/c(N)
count if sim_access <= 1000
di 100*r(N)/c(N)